name: netdata-stack
runtime: yaml
description: Deploy netdata parent node
config:
  hostedZoneId:
    type: string
    secret: true
resources:
  eks-provider:
    type: kubernetes:providers:Provider
    properties:
      kubeconfig: file:./kubeconfig.yml

  netdata-helm-chart:
    type: kubernetes:helm.sh/v3:Release
    properties:
      chart: netdata
      version: 1.31.0
      namespace: monitoring
      values:
        netdata:
          enabled: true
          service:
            type: LoadBalancer
            annotations:
              service.beta.kubernetes.io/aws-load-balancer-internal: "true"
              service.beta.kubernetes.io/aws-load-balancer-extra-security-groups: ${netdata-security-group}
          config:
            enabled: true
            configMap:
              name: netdata-config
              key: netdata.conf
          dashboard:
            enabled: true
            configMap:
              name: netdata-config
              key: dashboard_info.js
          health:
            enabled: true
            configMap:
              name: netdata-config
              key: health_alarm_notify.conf
          plugins:
            enabled: true
            configMap:
              name: netdata-config
              key: python.d.conf
          registry:
            enabled: true
            configMap:
              name: netdata-config
              key: registry.conf
          stream:
            enabled: true
            configMap:
              name: netdata-config
              key: stream.conf
          web:
            enabled: true
            configMap:
              name: netdata-config
              key: web.conf
          prometheus:
            enabled: true
            configMap:
              name: netdata-config
              key: prometheus.conf
          health:
            enabled: true
            configMap:
              name: netdata-config
              key: health_alarm_notify.conf
          plugins:
            enabled: true
            configMap:
              name: netdata-config
              key: python.d.conf
          registry:
            enabled: true
            configMap:
              name: netdata-config
              key: registry.conf
          stream:
            enabled: true
            configMap:
              name: netdata-config
              key: stream.conf
          web:
            enabled: true
            configMap:
              name: netdata-config
              key: web.conf
          prometheus:
            enabled: true
            configMap:
              name: netdata-config
              key: prometheus.conf
          health:
            enabled: true
            configMap:
              name: netdata-config
              key: health_alarm_notify.conf
